---
id: github
title: Github Integration
---
# Github Integration

import { Image } from '@components';

## Overview

This guide outlines the process for integrating GitHub workflows with Drill4J to publish a change testing report for your application.
The change testing report provides valuable insights, including:
- A summary of changes made
- Identification of changes that have been tested versus those that have not
- The percentage of modified code that is covered by tests

The integration process typically involves the following steps:
1. [Build your application and send the build information to Drill4J](#sending-a-build-info-to-drill4j).
2. [Deploy the application with the Drill4J Application Agent](#deploy-an-application-together-with-app-agent).
3. [Run API tests using the Drill4J Test Agent](#running-tests-together-with-test-agent).
4. [Submit a Drill4J Change Testing Report](#submitting-a-change-testing-report).

## Prerequisites

Before proceeding, please ensure the following:
1. Familiarity with the [Github workflow](https://docs.github.com/en/actions/writing-workflows).
2. Your application is built using either Gradle or Maven.
3. The [Drill4J Core Services](../getting-started/local-deployment) is deployed.
4. The [set up Drill4J CI/CD Integration plugin](../cicd-integration/cicd-integration-plugin#adding-plugin) is configured in your Gradle or Maven build file.

## Sending a build info to Drill4J

The initial step in integrating Drill4J with your application is to submit the build information.
This data provides key details about the commit, author, and branch associated with your applicationâ€™s build.
Such information is crucial for identifying your build in the Drill4J reports and dashboards.

> Typically, the process of submitting build information is executed as part of the build job within your CI/CD workflow.

1. Ensure that the CI/CD Integration Plugin is configured for sending build information.
For guidance, please refer to the [documentation](../cicd-integration/cicd-integration-plugin#sending-git-metadata-to-drill4j-api).

2. If your workflow is triggered by a Pull Request (PR) event, ensure that the repository is checked out from the `head ref`.
This can be done by specifying `ref: ${{ github.head_ref }}` in the `checkout@v4` action, as shown below:
```yml
  uses: actions/checkout@v4
  with:
    ref: ${{ github.head_ref }}  // Required for Pull Request events
```
> By default, during a Pull Request event, the checkout action creates a merge commit with the target branch.
Since this commit is not pushed, it cannot be compared with other commits.
For additional details, please refer to the [GitHub documentation](https://docs.github.com/en/actions/writing-workflows/choosing-when-your-workflow-runs/events-that-trigger-workflows#pull_request).

3. Depending on your build tool, use the following commands to submit the build information:

##### Gradle
```yml
- name: Send build info to Drill4J
  run: ./gradlew drillSendBuildInfo
```

##### Maven
```yml
- name: Send build info to Drill4J
  run: ./mvn drill:sendBuildInfo
```

3. Once the build information has been successfully submitted, detailed insights will be available in the "Build - Summary" Metabase Dashboard.

## Deploy an application together with App Agent

Running your application under test together with the Drill4J Application Agent enables the following functionalities:
- Identification of which classes and methods have changed.
- Collection of test coverage data.

To deploy an application under test together with the Application Agent, follow these steps:

1. Set Up the Application Agent.
There are two ways to launch your application alongside the Application Agent:
- [Set the -agentpath JVM argument](../agents/java-agent#how-to-set-path-to-agent).
- [Use the CI/CD Integration Plugin](../cicd-integration/cicd-integration-plugin#application-agent).

2. Before starting the application, you need to pass the `commitSha` parameter.
This helps determine the merge base commit for comparing changes across branches.
For further information on `commitSha`, refer to the [documentation](http://localhost:3000/docs/agents/java-agent#considerations-regarding-buildversion-and-commitsha).

The simplest way to pass the `commitSha` in a GitHub workflow is by setting the environment variable `DRILL_COMMIT_SHA`.
The method of setting this variable depends on the GitHub event that triggers the workflow.

##### For Pull Request events
For Pull Request events, use the `github.event.pull_request.head.sha` variable:
```yml
- name: Deploy the application
  run: [your app launching command here]
  env:
    DRILL_COMMIT_SHA: ${{ github.event.pull_request.head.sha }}
```

##### For Push events
For push events to protected branches, use the `github.sha` variable:
```yml
- name: Deploy the application
  run: [your app launching command here]
  env:
    DRILL_COMMIT_SHA: ${{ github.sha }}
```

3. Ensure that the information about classes and methods is correctly passed to the Drill4J using the "Classes" Metabase Dashboard.

## Running tests together with Test Agent

Running your tests alongside the Drill4J Test Agent provides the following advantages:
- Track the specific code coverage achieved by each test.
- Prioritize test execution based on changes made in the application.

To run tests together with Test Agent:
1. Ensure that the Test Agent is enabled in the CI/CD Integration Plugin. For guidance, please refer to the [documentation](../cicd-integration/cicd-integration-plugin#set-up).
2. Once the Test Agent is enabled, run your tests as you normally would.
Use the following commands based on your build tool:

##### Gradle
```yml
- name: Run API tests
  run: ./gradlew test
```

##### Maven
```yml
- name: Run API tests
  run: ./mvn test
```

3. After the tests have been executed, you will be able to view which tests impacted your application's code on the "Tests" Metabase dashboard.

## Submitting a change testing report

Once your tests have been completed, Drill4J can generate a report detailing the changes tested in your pull request or those made since the last release.

> Ensure that all tests are fully completed before submitting a change testing report.
The report submission should not be done before or during the test execution process.

1. Before submitting the report, add the `fetch-depth: 0` parameter to your GitHub `checkout@v4` action:

```yml
  uses: actions/checkout@v4
  with:
    fetch-depth: 0
```
This ensures that you retrieve the necessary git history, including the merge base commit.

> By default, the `checkout@v4` action fetches only a single commit, which may not include the necessary git history.

2. The command to submit a report differs depending on the type of GitHub event that triggered the workflow:
- **Pull Request Event:** The report can be posted as a comment on the Pull Request.
- **Push Event:** The report can be attached as a file within the workflow.

### As a Pull Request comment

3. If you plan to submit the report as a Pull Request comment,
ensure that the [Github token in CI/CD Integration Plugin](../cicd-integration/cicd-integration-plugin#github-pull-request-report)
is correctly configured in the CI/CD Integration Plugin.

> You can [](https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens)

4. Use the following commands in your GitHub workflow to submit the report as a Pull Request comment:

##### Gradle
```yml
- name: Send a Change Testing Report
  run: ./gradlew drillGithubPullRequestReport
```

##### Maven
```yml
- name: Send a Change Testing Report
  run: ./mvn drill:githubPullRequestReport
```

5. After the command is successfully executed, check the comments section of the Pull Request for the submitted report.
<Image alt="GitHub Pull Request Report" src="/img/0.9.0/github/github-pr-report.png" />

### As a workflow attachment

3. If you prefer to submit the report as a file attachment in your workflow, first generate the report using the following commands:

##### Gradle
```yml
- name: Generate a Drill4J Change Testing Report
  run: ./gradlew drillGenerateChangeTestingReport
```

##### Maven
```yml
- name: Generate a Drill4J Change Testing Report
  run: ./mvn drill:generateChangeTestingReport
```

For more information on setting up this command, read [documentation](../cicd-integration/cicd-integration-plugin#generating-a-change-testing-report).

4. Once the report is generated, attach it to the workflow using the `upload-artifact` action:

##### Gradle
```yml
- name: Attach a report
  uses: actions/upload-artifact@v4
  with:
    name: change-testing-report
    path: ./build/drill-reports/drillReport.md
```

##### Maven
```yml
- name: Attach a report
  uses: actions/upload-artifact@v4
  with:
    name: change-testing-report
    path: ./target/drill-reports/drillReport.md
```

5. After successful execution of the commands, check the attachments in the workflow job to verify that the report has been correctly uploaded.
<Image alt="GitHub Workflow Report" src="/img/0.9.0/github/github-workflow-report.png" />

## Next Steps and Further Reading

This guide covered the basics of integration GitHub with Drill4J.
You can check out an example of integrating a [demo repository](https://github.com/Drill4J/realworld-spring-webflux) with GitHub workflow.

For more advanced metrics, integrate Drill4J with your tests. For more details, check out the additional documentation: