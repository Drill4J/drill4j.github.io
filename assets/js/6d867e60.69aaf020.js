(self.webpackChunkdrill4j_github_io=self.webpackChunkdrill4j_github_io||[]).push([[960],{1899:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return s},metadata:function(){return o},toc:function(){return d},default:function(){return u}});var i=n(2122),l=n(9756),r=(n(7294),n(3905)),a=n(549),s={id:"ci-cd-integration",title:"CI/CD Integration"},o={unversionedId:"drill4net/ci-cd-integration",id:"drill4net/ci-cd-integration",isDocsHomePage:!1,title:"CI/CD Integration",description:"The Drill4Net agent should run after the build step in CI/CD pipeline:",source:"@site/docs/drill4net/ci-cd-integration.mdx",sourceDirName:"drill4net",slug:"/drill4net/ci-cd-integration",permalink:"/docs/drill4net/ci-cd-integration",version:"current",frontMatter:{id:"ci-cd-integration",title:"CI/CD Integration"},sidebar:"docs",previous:{title:"Drill4J Admin Installation",permalink:"/docs/drill4net/drill4j-admin-installation"},next:{title:"Quick Start Guide",permalink:"/docs/drill4net/quick-start-guide"}},d=[{value:"1. One Time Setup",id:"1-one-time-setup",children:[{value:"1.1. Install Required NuGet Packages",id:"11-install-required-nuget-packages",children:[]},{value:"1.2. Use Drill4Net Middleware",id:"12-use-drill4net-middleware",children:[]},{value:"1.3. Install Drill4J Admin",id:"13-install-drill4j-admin",children:[]},{value:"1.4. Configure Test Agent",id:"14-configure-test-agent",children:[]},{value:"1.5. Build Application Under Test",id:"15-build-application-under-test",children:[]},{value:"1.6. Run Drill4Net Scanner",id:"16-run-drill4net-scanner",children:[]},{value:"1.7. Register Agent in Drill4J Admin",id:"17-register-agent-in-drill4j-admin",children:[]}]},{value:"2. Integrate in CI/CD Pipeline",id:"2-integrate-in-cicd-pipeline",children:[{value:"2.1. Change Build Version in Configurations",id:"21-change-build-version-in-configurations",children:[]},{value:"2.2. Run Drill4Net Scanner",id:"22-run-drill4net-scanner",children:[]},{value:"2.3. Run Test Agent",id:"23-run-test-agent",children:[]},{value:"2.4. Run Integration Tests",id:"24-run-integration-tests",children:[]},{value:"2.5. Get Suggested Tests to Run",id:"25-get-suggested-tests-to-run",children:[]}]}],p={toc:d};function u(e){var t=e.components,n=(0,l.Z)(e,["components"]);return(0,r.kt)("wrapper",(0,i.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"The Drill4Net agent should run after the build step in CI/CD pipeline:"),(0,r.kt)(a.Ee,{src:"/img/drill4net/drill4net-build-pipeline.svg",mdxType:"Image"}),(0,r.kt)("h2",{id:"1-one-time-setup"},"1. One Time Setup"),(0,r.kt)("h3",{id:"11-install-required-nuget-packages"},"1.1. Install Required NuGet Packages"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Install ",(0,r.kt)("a",{parentName:"li",href:"https://www.nuget.org/packages/Drill4Net.Receiver"},"Drill4Net.Receiver")," in ",(0,r.kt)("em",{parentName:"li"},"application under test")," start up project."),(0,r.kt)("li",{parentName:"ol"},"Install ",(0,r.kt)("a",{parentName:"li",href:"https://www.nuget.org/packages/Drill4Net.Receiver.WebApi"},"Drill4Net.Receiver.WebApi")," in ",(0,r.kt)("em",{parentName:"li"},"application under test")," start up project."),(0,r.kt)("li",{parentName:"ol"},"Install ",(0,r.kt)("a",{parentName:"li",href:"https://www.nuget.org/packages/Drill4Net.TestAgent.NUnit"},"Drill4Net.TestAgent.NUnit")," or ",(0,r.kt)("a",{parentName:"li",href:"https://www.nuget.org/packages/Drill4Net.TestAgent.XUnit"},"Drill4Net.TestAgent.XUnit"),"\nin ",(0,r.kt)("em",{parentName:"li"},"assembly with tests")," based on test framework used in your ",(0,r.kt)("em",{parentName:"li"},"assembly with tests"),".")),(0,r.kt)("h3",{id:"12-use-drill4net-middleware"},"1.2. Use Drill4Net Middleware"),(0,r.kt)("p",null,"Add the following line in you ",(0,r.kt)("inlineCode",{parentName:"p"},"Startup.Configure")," method:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"app.UseDrill4NetReceiverWebApi();\n")),(0,r.kt)("p",null,"Make sure you added ",(0,r.kt)("inlineCode",{parentName:"p"},"using Drill4Net.Receiver.WebApi;"),"."),(0,r.kt)("h3",{id:"13-install-drill4j-admin"},"1.3. Install Drill4J Admin"),(0,r.kt)("p",null,"First of all you need to install ",(0,r.kt)("em",{parentName:"p"},"Drill4J Admin"),". Follow ",(0,r.kt)("a",{parentName:"p",href:"./drill4j-admin-installation"},"this guide"),"\nto see the different installation ways and find the right one for you."),(0,r.kt)("h3",{id:"14-configure-test-agent"},"1.4. Configure Test Agent"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Download ",(0,r.kt)("em",{parentName:"li"},"Test Agent (drill4net-injector-app)")," for your system ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/Drill4J/dotnet-releases/releases/tag/v1.0.0"},"here"),"."),(0,r.kt)("li",{parentName:"ol"},"Configure ",(0,r.kt)("em",{parentName:"li"},"Test Agent")," as described ",(0,r.kt)("a",{parentName:"li",href:"./configuration#test-agent-configuration"},"here"),".")),(0,r.kt)("h3",{id:"15-build-application-under-test"},"1.5. Build Application Under Test"),(0,r.kt)("p",null,"Build application under tests, so you can proceed with following steps"),(0,r.kt)("h3",{id:"16-run-drill4net-scanner"},"1.6. Run Drill4Net Scanner"),(0,r.kt)("p",null,"You need to run ",(0,r.kt)("em",{parentName:"p"},"Drill4Net Scanner")," to prepare application under tests."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Make sure Drill4Net Admin is up and running."),(0,r.kt)("li",{parentName:"ol"},"Download ",(0,r.kt)("em",{parentName:"li"},"Drill4Net Scanner (drill4net-scanner)")," for your system ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/Drill4J/dotnet-releases/releases/tag/v1.0.0"},"here"),"."),(0,r.kt)("li",{parentName:"ol"},"Configure ",(0,r.kt)("em",{parentName:"li"},"Drill4Net Scanner")," as described ",(0,r.kt)("a",{parentName:"li",href:"./configuration#drill4net-scanner-configuration"},"here"),"."),(0,r.kt)("li",{parentName:"ol"},"Run Drill4Net.Scanner. There are two required arguments:")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Directory with binaries of application under test"),(0,r.kt)("li",{parentName:"ul"},"Application under test executable (",(0,r.kt)("inlineCode",{parentName:"li"},"--target"),")\nExample for Windows:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'start Drill4Net.Scanner.exe "d:\\Builds\\AppUnderTest\\bin\\Release\\netcoreapp3.1" \\\n  --target "d:\\Builds\\AppUnderTest\\bin\\Release\\netcoreapp3.1\\Paralel.exe"\n')),(0,r.kt)("ol",{start:5},(0,r.kt)("li",{parentName:"ol"},"There are also optional parameters described ",(0,r.kt)("a",{parentName:"li",href:"./drill4net-scanner-parameters"},"here"),".")),(0,r.kt)("h3",{id:"17-register-agent-in-drill4j-admin"},"1.7. Register Agent in Drill4J Admin"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"After you launched ",(0,r.kt)("em",{parentName:"li"},"Drill4Net Scanner"),", navigate to ",(0,r.kt)("em",{parentName:"li"},"Drill4J Admin UI"),"."),(0,r.kt)("li",{parentName:"ol"},"Click ",(0,r.kt)("em",{parentName:"li"},"Select Agent")," --\x3e ",(0,r.kt)("em",{parentName:"li"},"Add Agent")),(0,r.kt)("li",{parentName:"ol"},"You should see agent with name specified in ",(0,r.kt)("inlineCode",{parentName:"li"},"adminAgentConfig:id")," earlier and .NET type. Click ",(0,r.kt)("em",{parentName:"li"},"Register"),".",(0,r.kt)(a.Ee,{src:"/img/drill4net/add-agent.png",mdxType:"Image"})),(0,r.kt)("li",{parentName:"ol"},"Now you can see your agent information. Click ",(0,r.kt)("em",{parentName:"li"},"Next"),".",(0,r.kt)(a.Ee,{src:"/img/drill4net/agent-registration-01.png",mdxType:"Image"})),(0,r.kt)("li",{parentName:"ol"},"Enter arbirtary value in ",(0,r.kt)("em",{parentName:"li"},"Target Host")," field. This value will not make any effect. This field was made for Java and JavaScript agents.\nIn future we are going to implement autoregistration, so this field is not required for .NET Agent. Simply click ",(0,r.kt)("em",{parentName:"li"},"Next"),".",(0,r.kt)(a.Ee,{src:"/img/drill4net/agent-registration-02.png",mdxType:"Image"})),(0,r.kt)("li",{parentName:"ol"},"Check ",(0,r.kt)("em",{parentName:"li"},"Test2Code")," and click ",(0,r.kt)("em",{parentName:"li"},"Finish"),".",(0,r.kt)(a.Ee,{src:"/img/drill4net/agent-registration-03.png",mdxType:"Image"})),(0,r.kt)("li",{parentName:"ol"},"Now you can select newly created agent and go to ",(0,r.kt)("em",{parentName:"li"},"Test2Code"),". You should see your class structure:",(0,r.kt)(a.Ee,{src:"/img/drill4net/test2code-01.png",mdxType:"Image"}),"The full agent registration process should look like this:",(0,r.kt)("details",null,(0,r.kt)("summary",null,"Click here to view full agent registration process"),(0,r.kt)(a.Ee,{src:"/img/drill4net/agent-registration-process.gif",mdxType:"Image"})))),(0,r.kt)("h2",{id:"2-integrate-in-cicd-pipeline"},"2. Integrate in CI/CD Pipeline"),(0,r.kt)("p",null,"Now you can integrate Drill4Net in CI/CD pipeline. Perform the following steps after the build step is finished."),(0,r.kt)("h3",{id:"21-change-build-version-in-configurations"},"2.1. Change Build Version in Configurations"),(0,r.kt)("p",null,"Each build should change build version in ",(0,r.kt)("em",{parentName:"p"},"Test Agent")," and ",(0,r.kt)("em",{parentName:"p"},"Drill4Net Scanner")," appsettings.yml."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Change ",(0,r.kt)("inlineCode",{parentName:"li"},"adminAgentConfig:buildVersion")," in ",(0,r.kt)("em",{parentName:"li"},"Drill4Net Scanner")," appsettings.yml to version of current build."),(0,r.kt)("li",{parentName:"ol"},"Change ",(0,r.kt)("inlineCode",{parentName:"li"},"AdminAgentConfig:BuildVersion")," in ",(0,r.kt)("em",{parentName:"li"},"Test Agent")," drill4netsettings.yml to version of current build.")),(0,r.kt)("h3",{id:"22-run-drill4net-scanner"},"2.2. Run Drill4Net Scanner"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"#16-run-drill4net-scanner"},"Run Drill4Net Scanner")," for current build."),(0,r.kt)("h3",{id:"23-run-test-agent"},"2.3. Run Test Agent"),(0,r.kt)("p",null,"Run Drill4Net.Injector.App for current build. Example for Windows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"start Drill4Net.Injector.App.exe\n")),(0,r.kt)("p",null,"You can also provide ",(0,r.kt)("inlineCode",{parentName:"p"},"TestAssemblySourcePath")," argument. In this case, value from drill4netsettings.yml will be overriden. Example for Windows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'start Drill4Net.Injector.App.exe "d:\\Builds\\AppUnderTest.Tests\\netcoreapp3.1\\Ipreo.XUnit.Tests.dll"\n')),(0,r.kt)("h3",{id:"24-run-integration-tests"},"2.4. Run Integration Tests"),(0,r.kt)("p",null,"Run your integration tests from assembly provided to ",(0,r.kt)("em",{parentName:"p"},"Test Agent"),". Note that tests should run only after Drill4Net.Injector.App run is\nsuccessfully finsihed. Make sure you run tests without rebuilding before running tests."),(0,r.kt)("h3",{id:"25-get-suggested-tests-to-run"},"2.5. Get Suggested Tests to Run"),(0,r.kt)("p",null,"You can execute the ",(0,r.kt)("inlineCode",{parentName:"p"},"curl")," command to get suggested tests to run:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'curl -i -H "accept: application/json" \\\n  -H "content-type: application/json" \\\n  -X GET {drill4j-address}/api/agents/{agent-id}/plugins/test2code/data/tests-to-run\n')),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"drill4j-address")," is the address of ",(0,r.kt)("em",{parentName:"p"},"Drill4J Admin"),", for example ",(0,r.kt)("inlineCode",{parentName:"p"},"http://localhost:8091"),"."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"agent-id")," is the value of ",(0,r.kt)("inlineCode",{parentName:"p"},"adminAgentConfig:id")," provided in ",(0,r.kt)("em",{parentName:"p"},"Drill4Net Scanner")," earlier."))}u.isMDXComponent=!0}}]);