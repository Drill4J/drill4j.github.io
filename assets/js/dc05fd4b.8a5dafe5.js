(self.webpackChunkdrill4j_github_io=self.webpackChunkdrill4j_github_io||[]).push([[6626],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return c},kt:function(){return s}});var i=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},l=Object.keys(e);for(i=0;i<l.length;i++)n=l[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(i=0;i<l.length;i++)n=l[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=i.createContext({}),u=function(e){var t=i.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},c=function(e){var t=u(e.components);return i.createElement(p.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},k=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,l=e.originalType,p=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),k=u(n),s=a,m=k["".concat(p,".").concat(s)]||k[s]||d[s]||l;return n?i.createElement(m,r(r({ref:t},c),{},{components:n})):i.createElement(m,r({ref:t},c))}));function s(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var l=n.length,r=new Array(l);r[0]=k;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o.mdxType="string"==typeof e?e:a,r[1]=o;for(var u=2;u<l;u++)r[u]=n[u];return i.createElement.apply(null,r)}return i.createElement.apply(null,n)}k.displayName="MDXCreateElement"},3886:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return r},metadata:function(){return o},toc:function(){return p},default:function(){return c}});var i=n(2122),a=n(9756),l=(n(7294),n(3905)),r={},o={unversionedId:"guides/keycloak",id:"version-0.9.0/guides/keycloak",isDocsHomePage:!1,title:"Integration with Keycloak Auth Server",description:"To enable authentication with Auth Provider in Drill4J, you can integrate it with Keycloak, an open-source identity and access management solution.",source:"@site/versioned_docs/version-0.9.0/guides/keycloak.mdx",sourceDirName:"guides",slug:"/guides/keycloak",permalink:"/docs/guides/keycloak",version:"0.9.0",frontMatter:{},sidebar:"version-0.9.0/docs",previous:{title:"WildFly integration",permalink:"/docs/guides/wildfly"},next:{title:"Releases",permalink:"/docs/releases"}},p=[{value:"Prerequisites",id:"prerequisites",children:[]},{value:"Step 1: Set Up Keycloak",id:"step-1-set-up-keycloak",children:[]},{value:"Step 2: Configure Drill4J Backend",id:"step-2-configure-drill4j-backend",children:[]},{value:"Step 3: Verify the Integration",id:"step-3-verify-the-integration",children:[]},{value:"Troubleshooting",id:"troubleshooting",children:[]}],u={toc:p};function c(e){var t=e.components,n=(0,a.Z)(e,["components"]);return(0,l.kt)("wrapper",(0,i.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"To enable authentication with Auth Provider in Drill4J, you can integrate it with Keycloak, an open-source identity and access management solution.\nThis guide will walk you through the steps to set up Keycloak and configure Drill4J to use it for authentication."),(0,l.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Keycloak 22.0.5. You can download it from the ",(0,l.kt)("a",{parentName:"li",href:"https://www.keycloak.org/downloads"},"Keycloak website")," and follow the installation instructions."),(0,l.kt)("li",{parentName:"ul"},"A running instance of Drill4J Backend & UI.")),(0,l.kt)("h2",{id:"step-1-set-up-keycloak"},"Step 1: Set Up Keycloak"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("strong",{parentName:"li"},"Create a Realm"),': Log in to the Keycloak admin console and create a new realm for your Drill4J instance.\nYou can use default realm "master" if preferred.'),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("strong",{parentName:"li"},"Create a Client"),": Within the newly created realm, create a new client for Drill4J.",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Set the Client Type to ",(0,l.kt)("inlineCode",{parentName:"li"},"OpenID Connect"),"."),(0,l.kt)("li",{parentName:"ul"},"Set the Client ID to ",(0,l.kt)("inlineCode",{parentName:"li"},"drill4j"),"."),(0,l.kt)("li",{parentName:"ul"},"Click Next."),(0,l.kt)("li",{parentName:"ul"},"Set Client Authentication to ",(0,l.kt)("inlineCode",{parentName:"li"},"ON")," to grant OIDC Access Type confidential."),(0,l.kt)("li",{parentName:"ul"},"Set ",(0,l.kt)("inlineCode",{parentName:"li"},"Standard Flow")," flag for Authentication Flow."),(0,l.kt)("li",{parentName:"ul"},"Click Next."),(0,l.kt)("li",{parentName:"ul"},"Set Valid Redirect URIs to ",(0,l.kt)("inlineCode",{parentName:"li"},"http://<DRILL4J_UI_HOST>:<DRILL4J_UI_PORT>/oauth/callback")," (replace ",(0,l.kt)("inlineCode",{parentName:"li"},"<DRILL4J_UI_HOST>")," and ",(0,l.kt)("inlineCode",{parentName:"li"},"<DRILL4J_UI_PORT>")," with your Drill4J UI host and port)."),(0,l.kt)("li",{parentName:"ul"},"Click Save to create the client."),(0,l.kt)("li",{parentName:"ul"},"On the Client Details page of the ",(0,l.kt)("inlineCode",{parentName:"li"},"drill4j")," client, navigate to the ",(0,l.kt)("inlineCode",{parentName:"li"},"Credentials")," tab."),(0,l.kt)("li",{parentName:"ul"},"Copy the ",(0,l.kt)("inlineCode",{parentName:"li"},"Client secret")," value. You will need this for configuring Drill4J."))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("strong",{parentName:"li"},"Create Roles"),": On the Client Details page of the ",(0,l.kt)("inlineCode",{parentName:"li"},"drill4j")," client, navigate to the ",(0,l.kt)("inlineCode",{parentName:"li"},"Roles")," tab to create roles that correspond to Drill4J user roles (e.g., ",(0,l.kt)("inlineCode",{parentName:"li"},"admin"),", ",(0,l.kt)("inlineCode",{parentName:"li"},"user"),").",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Click Create role and enter the role name ",(0,l.kt)("inlineCode",{parentName:"li"},"admin"),"."),(0,l.kt)("li",{parentName:"ul"},"Click Save."),(0,l.kt)("li",{parentName:"ul"},"Repeat the process to create a ",(0,l.kt)("inlineCode",{parentName:"li"},"user")," role."))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("strong",{parentName:"li"},"Client Scopes Mapping"),": Go to the ",(0,l.kt)("inlineCode",{parentName:"li"},"Client Scopes")," tab.",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Find the ",(0,l.kt)("inlineCode",{parentName:"li"},"roles")," scope and click on it."),(0,l.kt)("li",{parentName:"ul"},"In the ",(0,l.kt)("inlineCode",{parentName:"li"},"Mappers")," tab, click on ",(0,l.kt)("inlineCode",{parentName:"li"},"Add mapper > By configuration"),"."),(0,l.kt)("li",{parentName:"ul"},"On the ",(0,l.kt)("inlineCode",{parentName:"li"},"Configure a new mapper")," window, choose the ",(0,l.kt)("inlineCode",{parentName:"li"},"User Client Role"),"."),(0,l.kt)("li",{parentName:"ul"},"Set the ",(0,l.kt)("inlineCode",{parentName:"li"},"Name")," to ",(0,l.kt)("inlineCode",{parentName:"li"},"drill4j-roles"),"."),(0,l.kt)("li",{parentName:"ul"},"Set the ",(0,l.kt)("inlineCode",{parentName:"li"},"Client ID")," to ",(0,l.kt)("inlineCode",{parentName:"li"},"drill4j"),"."),(0,l.kt)("li",{parentName:"ul"},"Set the ",(0,l.kt)("inlineCode",{parentName:"li"},"Token Claim Name")," to ",(0,l.kt)("inlineCode",{parentName:"li"},"roles"),"."),(0,l.kt)("li",{parentName:"ul"},"Set Multivalued to ",(0,l.kt)("inlineCode",{parentName:"li"},"ON"),"."),(0,l.kt)("li",{parentName:"ul"},"Set ",(0,l.kt)("inlineCode",{parentName:"li"},"Claim JSON Type")," to ",(0,l.kt)("inlineCode",{parentName:"li"},"String"),"."),(0,l.kt)("li",{parentName:"ul"},"Set ",(0,l.kt)("inlineCode",{parentName:"li"},"Add to access token")," to ",(0,l.kt)("inlineCode",{parentName:"li"},"ON"),"."),(0,l.kt)("li",{parentName:"ul"},"Click Save."))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("strong",{parentName:"li"},"Create Users"),": Navigate to the ",(0,l.kt)("inlineCode",{parentName:"li"},"Users")," tab and create users for Drill4J.",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Click Add user and fill in the required fields (Username, Email, First Name, Last Name)."),(0,l.kt)("li",{parentName:"ul"},"Click Create."),(0,l.kt)("li",{parentName:"ul"},"After creating the user, go to the ",(0,l.kt)("inlineCode",{parentName:"li"},"Credentials")," tab to set a password for the user."),(0,l.kt)("li",{parentName:"ul"},"Set ",(0,l.kt)("inlineCode",{parentName:"li"},"Temporary")," to ",(0,l.kt)("inlineCode",{parentName:"li"},"OFF")," if you don't want the user to change the password on first login."),(0,l.kt)("li",{parentName:"ul"},"Click Set Password."),(0,l.kt)("li",{parentName:"ul"},"Go to the ",(0,l.kt)("inlineCode",{parentName:"li"},"Role Mappings")," tab to assign roles to the user."),(0,l.kt)("li",{parentName:"ul"},"Select the ",(0,l.kt)("inlineCode",{parentName:"li"},"drill4j")," client from the Client Roles dropdown."),(0,l.kt)("li",{parentName:"ul"},"Assign the appropriate roles (e.g., ",(0,l.kt)("inlineCode",{parentName:"li"},"admin"),", ",(0,l.kt)("inlineCode",{parentName:"li"},"user"),") to the user."))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("strong",{parentName:"li"},"Open OpenID Configuration"),": To get the OpenID configuration URL, navigate to:",(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre"},"http://<KEYCLOAK_HOST>:<KEYCLOAK_PORT>/realms/<REALM_NAME>/.well-known/openid-configuration\n")),"Replace ",(0,l.kt)("inlineCode",{parentName:"li"},"<KEYCLOAK_HOST>"),", ",(0,l.kt)("inlineCode",{parentName:"li"},"<KEYCLOAK_PORT>"),", and ",(0,l.kt)("inlineCode",{parentName:"li"},"<REALM_NAME>")," with your Keycloak host, port, and realm name respectively.\nThis URL provides the necessary endpoints for Drill4J to interact with Keycloak.")),(0,l.kt)("h2",{id:"step-2-configure-drill4j-backend"},"Step 2: Configure Drill4J Backend"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("strong",{parentName:"li"},"Set environment variables"),": You need to set the following environment variables for Drill4J Backend to connect to Keycloak:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Set ",(0,l.kt)("inlineCode",{parentName:"li"},"DRILL_OAUTH2_ENABLED")," to ",(0,l.kt)("inlineCode",{parentName:"li"},"true"),"."),(0,l.kt)("li",{parentName:"ul"},"Set ",(0,l.kt)("inlineCode",{parentName:"li"},"DRILL_OAUTH2_AUTHORIZE_URL")," to the Keycloak authorization endpoint (See ",(0,l.kt)("inlineCode",{parentName:"li"},"authorization_endpoint")," in the OpenID configuration)"),(0,l.kt)("li",{parentName:"ul"},"Set ",(0,l.kt)("inlineCode",{parentName:"li"},"DRILL_OAUTH2_ACCESS_TOKEN_URL")," to the Keycloak token endpoint (See ",(0,l.kt)("inlineCode",{parentName:"li"},"token_endpoint")," in the OpenID configuration)"),(0,l.kt)("li",{parentName:"ul"},"Set ",(0,l.kt)("inlineCode",{parentName:"li"},"DRILL_OAUTH2_REDIRECT_URL")," to ",(0,l.kt)("inlineCode",{parentName:"li"},"http://<DRILL4J_HOST>:<DRILL4J_UI_PORT>")),(0,l.kt)("li",{parentName:"ul"},"Set ",(0,l.kt)("inlineCode",{parentName:"li"},"DRILL_OAUTH2_CLIENT_ID")," to ",(0,l.kt)("inlineCode",{parentName:"li"},"drill4j"),"."),(0,l.kt)("li",{parentName:"ul"},"Set ",(0,l.kt)("inlineCode",{parentName:"li"},"DRILL_OAUTH2_CLIENT_SECRET")," to the client secret you copied earlier"),(0,l.kt)("li",{parentName:"ul"},"Set ",(0,l.kt)("inlineCode",{parentName:"li"},"DRILL_OAUTH2_SCOPES")," to ",(0,l.kt)("inlineCode",{parentName:"li"},"openid,roles"),"."),(0,l.kt)("li",{parentName:"ul"},"Set ",(0,l.kt)("inlineCode",{parentName:"li"},"DRILL_OAUTH2_TOKEN_MAPPING_USERNAME")," to ",(0,l.kt)("inlineCode",{parentName:"li"},"preferred_username")," according to default Keycloak client scope mapping."),(0,l.kt)("li",{parentName:"ul"},"Set ",(0,l.kt)("inlineCode",{parentName:"li"},"DRILL_OAUTH2_TOKEN_MAPPING_ROLES")," to ",(0,l.kt)("inlineCode",{parentName:"li"},"roles"),"."),(0,l.kt)("li",{parentName:"ul"},"If you want to disable Simple Authentication and allow only OAuth2 authentication, set ",(0,l.kt)("inlineCode",{parentName:"li"},"DRILL_AUTH_SIMPLE_ENABLED")," to ",(0,l.kt)("inlineCode",{parentName:"li"},"false")," and set ",(0,l.kt)("inlineCode",{parentName:"li"},"DRILL_OAUTH2_AUTOMATIC_SIGN_IN")," to ",(0,l.kt)("inlineCode",{parentName:"li"},"true"),"."))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("strong",{parentName:"li"},"Restart Drill4J Backend"),": After setting the environment variables, restart the Drill4J Backend service to apply the changes.")),(0,l.kt)("h2",{id:"step-3-verify-the-integration"},"Step 3: Verify the Integration"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("strong",{parentName:"li"},"Access Drill4J UI"),": Open your web browser and navigate to the Drill4J UI URL."),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("strong",{parentName:"li"},"Login with Auth Provider"),":",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Case 1: If you have enabled Simple Authentication ",(0,l.kt)("inlineCode",{parentName:"li"},"DRILL_AUTH_SIMPLE_ENABLED=true"),', click the "Sign in with Auth Provider" button in the login window.'),(0,l.kt)("li",{parentName:"ul"},"Case 2: If you have disabled Simple Authentication ",(0,l.kt)("inlineCode",{parentName:"li"},"DRILL_AUTH_SIMPLE_ENABLED=false")," and enabled OAuth Automatic Sign In ",(0,l.kt)("inlineCode",{parentName:"li"},"DRILL_OAUTH2_AUTOMATIC_SIGN_IN=true"),", you will be automatically redirected to the Keycloak login page."))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("strong",{parentName:"li"},"Authenticate"),": Enter the credentials of a user you created in Keycloak."),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("strong",{parentName:"li"},"Access Drill4J"),": After successful authentication, you should be redirected back to the Drill4J UI and logged in with the appropriate role.")),(0,l.kt)("h2",{id:"troubleshooting"},"Troubleshooting"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"If you encounter issues during the integration, set Drill4J Backend logging level to ",(0,l.kt)("inlineCode",{parentName:"li"},"TRACE")," to get detailed logs and check for any errors.")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"LOG_LEVEL=TRACE\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Ensure that the Keycloak server is running and accessible from the Drill4J Backend."),(0,l.kt)("li",{parentName:"ul"},"Verify that the environment variables are correctly set and that the URLs are accurate."),(0,l.kt)("li",{parentName:"ul"},"Check the Keycloak logs for any authentication errors.")))}c.isMDXComponent=!0}}]);