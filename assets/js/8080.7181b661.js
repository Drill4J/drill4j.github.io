(self.webpackChunkdrill4j_github_io=self.webpackChunkdrill4j_github_io||[]).push([[8080],{8080:function(e,t,s){"use strict";s.r(t),s.d(t,{diagram:function(){return A}});var a=s(6492),o=s(7058),i=s(2271),r=s(2561),n=s(6647),d=s(3125);s(7856),s(7484),s(8211),s(1089),s(1898),s(7967);const l="rect",c="rectWithTitle",p="statediagram",g="transition",b="parent",h="note",u="----parent",y="fill:none",f="fill: #333",m="text",w="normal";let x={},T=0;function k(e="",t=0,s="",a="----"){return`state-${e}${null!==s&&s.length>0?`${a}${s}`:""}-${t}`}const S=(e,t,s,o,i,n)=>{const d=s.id,p=null==(g=o[d])?"":g.classes?g.classes.join(" "):"";var g;if("root"!==d){let t=l;!0===s.start&&(t="start"),!1===s.start&&(t="end"),s.type!==a.a&&(t=s.type),x[d]||(x[d]={id:d,shape:t,description:r.e.sanitizeText(d,(0,r.g)()),classes:`${p} statediagram-state`});const o=x[d];s.description&&(Array.isArray(o.description)?(o.shape=c,o.description.push(s.description)):o.description.length>0?(o.shape=c,o.description===d?o.description=[s.description]:o.description=[o.description,s.description]):(o.shape=l,o.description=s.description),o.description=r.e.sanitizeTextOrArray(o.description,(0,r.g)())),1===o.description.length&&o.shape===c&&(o.shape=l),!o.type&&s.doc&&(r.l.info("Setting cluster for ",d,$(s)),o.type="group",o.dir=$(s),o.shape=s.type===a.b?"divider":"roundedWithTitle",o.classes=o.classes+" statediagram-cluster "+(n?"statediagram-cluster-alt":""));const i={labelStyle:"",shape:o.shape,labelText:o.description,classes:o.classes,style:"",id:d,dir:o.dir,domId:k(d,T),type:o.type,padding:15,centerLabel:!0};if(s.note){const t={labelStyle:"",shape:"note",labelText:s.note.text,classes:"statediagram-note",style:"",id:d+"----note-"+T,domId:k(d,T,h),type:o.type,padding:15},a={labelStyle:"",shape:"noteGroup",labelText:s.note.text,classes:o.classes,style:"",id:d+u,domId:k(d,T,b),type:"group",padding:0};T++;const r=d+u;e.setNode(r,a),e.setNode(t.id,t),e.setNode(d,i),e.setParent(d,r),e.setParent(t.id,r);let n=d,l=t.id;"left of"===s.note.position&&(n=t.id,l=d),e.setEdge(n,l,{arrowhead:"none",arrowType:"",style:y,labelStyle:"",classes:"transition note-edge",arrowheadStyle:f,labelpos:"c",labelType:m,thickness:w})}else e.setNode(d,i)}t&&"root"!==t.id&&(r.l.trace("Setting node ",d," to be child of its parent ",t.id),e.setParent(d,t.id)),s.doc&&(r.l.trace("Adding nodes children "),D(e,s,s.doc,o,i,!n))},D=(e,t,s,o,i,n)=>{r.l.trace("items",s),s.forEach((s=>{switch(s.stmt){case a.c:case a.a:S(e,t,s,o,i,n);break;case a.S:{S(e,t,s.state1,o,i,n),S(e,t,s.state2,o,i,n);const a={id:"edge"+T,arrowhead:"normal",arrowTypeEnd:"arrow_barb",style:y,labelStyle:"",label:r.e.sanitizeText(s.description,(0,r.g)()),arrowheadStyle:f,labelpos:"c",labelType:m,thickness:w,classes:g};e.setEdge(s.state1.id,s.state2.id,a,T),T++}}}))},$=(e,t=a.e)=>{let s=t;if(e.doc)for(let a=0;a<e.doc.length;a++){const t=e.doc[a];"dir"===t.stmt&&(s=t.value)}return s},v={setConf:function(e){const t=Object.keys(e);for(const s of t)e[s]},getClasses:function(e,t){r.l.trace("Extracting classes"),t.db.clear();try{return t.parser.parse(e),t.db.extract(t.db.getRootDocV2()),t.db.getClasses()}catch(s){return s}},draw:function(e,t,s,c){r.l.info("Drawing state diagram (v2)",t),x={};let g=c.db.getDirection();void 0===g&&(g=a.D);const{securityLevel:b,state:h}=(0,r.g)(),u=h.nodeSpacing||50,y=h.rankSpacing||50;r.l.info(c.db.getRootDocV2()),c.db.extract(c.db.getRootDocV2()),r.l.info(c.db.getRootDocV2());const f=c.db.getStates(),m=new o.k({multigraph:!0,compound:!0}).setGraph({rankdir:$(c.db.getRootDocV2()),nodesep:u,ranksep:y,marginx:8,marginy:8}).setDefaultEdgeLabel((function(){return{}}));let w;S(m,void 0,c.db.getRootDocV2(),f,c.db,!0),"sandbox"===b&&(w=(0,i.Ys)("#i"+t));const T="sandbox"===b?(0,i.Ys)(w.nodes()[0].contentDocument.body):(0,i.Ys)("body"),k=T.select(`[id="${t}"]`),D=T.select("#"+t+" g");(0,n.r)(D,m,["barb"],p,t);d.u.insertTitle(k,"statediagramTitleText",h.titleTopMargin,c.db.getDiagramTitle());const v=k.node().getBBox(),A=v.width+16,B=v.height+16;k.attr("class",p);const E=k.node().getBBox();(0,d.k)(k,B,A,h.useMaxWidth);const C=`${E.x-8} ${E.y-8} ${A} ${B}`;r.l.debug(`viewBox ${C}`),k.attr("viewBox",C);const R=document.querySelectorAll('[id="'+t+'"] .edgeLabel .label');for(const a of R){const e=a.getBBox(),t=document.createElementNS("http://www.w3.org/2000/svg",l);t.setAttribute("rx",0),t.setAttribute("ry",0),t.setAttribute("width",e.width),t.setAttribute("height",e.height),a.insertBefore(t,a.firstChild)}}},A={parser:a.p,db:a.d,renderer:v,styles:a.s,init:e=>{e.state||(e.state={}),e.state.arrowMarkerAbsolute=e.arrowMarkerAbsolute,a.d.clear()}}}}]);