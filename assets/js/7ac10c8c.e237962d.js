(self.webpackChunkdrill4j_github_io=self.webpackChunkdrill4j_github_io||[]).push([[4621],{395:function(e,t,a){"use strict";a.r(t),a.d(t,{frontMatter:function(){return l},metadata:function(){return p},toc:function(){return s},default:function(){return c}});var n=a(2122),i=a(9756),o=(a(7294),a(3905)),l={},p={unversionedId:"guides/tomcat",id:"version-0.9.0/guides/tomcat",isDocsHomePage:!1,title:"Tomcat integration",description:"For general reference, follow the Application Agent page.",source:"@site/versioned_docs/version-0.9.0/guides/tomcat.mdx",sourceDirName:"guides",slug:"/guides/tomcat",permalink:"/docs/guides/tomcat",version:"0.9.0",frontMatter:{},sidebar:"version-0.9.0/docs",previous:{title:"GitLab Integration",permalink:"/docs/cicd-integration/gitlab"},next:{title:"WildFly integration",permalink:"/docs/guides/wildfly"}},s=[{value:"Supply agent files to Tomcat",id:"supply-agent-files-to-tomcat",children:[]},{value:"Option 1 - Specify path to application archive",id:"option-1---specify-path-to-application-archive",children:[]},{value:"Option 2 - Delay the class scanning",id:"option-2---delay-the-class-scanning",children:[]},{value:"Troubleshooting",id:"troubleshooting",children:[]},{value:"Limitations",id:"limitations",children:[]}],r={toc:s};function c(e){var t=e.components,a=(0,i.Z)(e,["components"]);return(0,o.kt)("wrapper",(0,n.Z)({},r,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"For general reference, follow the ",(0,o.kt)("a",{parentName:"p",href:"/docs/agents/java-agent"},"Application Agent")," page."),(0,o.kt)("p",null,"This page describes a workaround for a known issue with Tomcat support:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Tomcat has a slight delay upon startup before it loads application files."),(0,o.kt)("li",{parentName:"ol"},"The Application Agent scans classes immediately after the Java process starts and the agent is loaded."),(0,o.kt)("li",{parentName:"ol"},"As a result, the Application Agent's scanning algorithm may finish before the application classes are fully loaded.")),(0,o.kt)("p",null,"There are two ways to work around this issue, described below."),(0,o.kt)("p",null,"First, proceed with the common step of supplying the agent files to Tomcat."),(0,o.kt)("h2",{id:"supply-agent-files-to-tomcat"},"Supply agent files to Tomcat"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"Deploy your application to Tomcat.")," Upon deployment, its files should be available in the ",(0,o.kt)("inlineCode",{parentName:"p"},"tomcat/webapps")," directory.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"Place the Application Agent files")," in the ",(0,o.kt)("inlineCode",{parentName:"p"},"tomcat/bin/agent")," directory.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"Set the ",(0,o.kt)("inlineCode",{parentName:"strong"},"CATALINA_OPTS")," environment variable")," for Tomcat to use the agent files:"),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"Windows")),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-cmd"},'set "CATALINA_OPTS=-agentpath:agent\\drill_agent.dll"\n')),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"Linux")),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"export CATALINA_OPTS=-agentpath:agent/libdrill_agent.so\n")),(0,o.kt)("p",{parentName:"li"},"Alternatively, you can set this directly in Tomcat's launch script (Windows: ",(0,o.kt)("inlineCode",{parentName:"p"},"bin/catalina.bat"),", Linux: ",(0,o.kt)("inlineCode",{parentName:"p"},"bin/catalina.sh"),")."))),(0,o.kt)("p",null,"Now you have two options to ensure the Application Agent successfully locates the application classes:"),(0,o.kt)("h2",{id:"option-1---specify-path-to-application-archive"},"Option 1 - Specify path to application archive"),(0,o.kt)("p",null,"Specify the ",(0,o.kt)("inlineCode",{parentName:"p"},"scanClassPath")," parameter to point to your application archive in Tomcat's directory."),(0,o.kt)("p",null,"You can set this in the ",(0,o.kt)("inlineCode",{parentName:"p"},"drill.properties")," file, which comes with the Application Agent files:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-properties"},'# Adjust to match the actual path to your JAR or WAR file:\nscanClassPath=../webapps/my-app.war\n\n# You can specify multiple paths using the ";" delimiter\n# scanClassPath=../webapps/my-app.war;../webapps/other-app.war\n\n# This example uses relative paths, assuming Tomcat is launched\n# with /tomcat/bin/catalina.bat (or .sh) script\n# but absolute paths work too\n# scanClassPath=C:/java/tomcat-10/webapps/helloworld.war\n')),(0,o.kt)("p",null,"Or set the ",(0,o.kt)("inlineCode",{parentName:"p"},"DRILL_SCAN_CLASS_PATH")," environment variable, following the same rules"),(0,o.kt)("ol",{start:5},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"Restart Tomcat and wait.")," The Application Agent should detect your application classes and send data to Drill4J.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"Check Metabase")," to confirm it has information on the application classes."))),(0,o.kt)("h2",{id:"option-2---delay-the-class-scanning"},"Option 2 - Delay the class scanning"),(0,o.kt)("p",null,"If specifying the direct path to your application isn't possible or practical (for instance, you manage many apps and the list frequently changes), you can use the Application Agent's ",(0,o.kt)("inlineCode",{parentName:"p"},"scanClassDelay")," parameter to delay the class scanning process."),(0,o.kt)("p",null,"Configure it in the ",(0,o.kt)("inlineCode",{parentName:"p"},"drill.properties")," file, which is included with the Application Agent files."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-properties"},"scanClassDelay=5000\n")),(0,o.kt)("p",null,"Or set ",(0,o.kt)("inlineCode",{parentName:"p"},"DRILL_SCAN_CLASS_DELAY")," environment variable"),(0,o.kt)("h2",{id:"troubleshooting"},"Troubleshooting"),(0,o.kt)("p",null,"If your application classes aren't showing up in Metabase after Tomcat is restarted and your application is loaded:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"To confirm the agent is loaded, refer to the Application Agent ",(0,o.kt)("a",{parentName:"p",href:"/docs/agents/java-agent#how-to-confirm-agent-is-loaded"},"Troubleshooting")," section.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Double-check that the correct ",(0,o.kt)("inlineCode",{parentName:"p"},"scanClassPath")," is specified.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"If you're using the ",(0,o.kt)("inlineCode",{parentName:"p"},"scanClassDelay")," approach, ensure the value is large enough for Tomcat to load the application classes, so your app loads before the Application Agent starts scanning."))),(0,o.kt)("h2",{id:"limitations"},"Limitations"),(0,o.kt)("p",null,"The Drill4J Application Agent cannot detect new applications deployed to Tomcat while it is already running. To allow the Application Agent to detect new application classes, Tomcat must be restarted."))}c.isMDXComponent=!0}}]);